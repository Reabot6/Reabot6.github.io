<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MyworldðŸ’œ</title>
    <link rel="icon" type="image/x-icon" href="love.png">
<script src="https://cdn.jsdelivr.net/npm/konva@8.0.0/konva.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        text-align: center;
    }

    #puzzle-container {
        margin: 20px auto;
        max-width: 800px;
        border: 2px solid #333;
        background-color: #fff;
    }
</style>
</head>
<body>

<h1>Upload Image and Solve the Puzzle</h1>
<input type="file" id="file-input">
<div id="puzzle-container"></div>

<script>
    const stage = new Konva.Stage({
        container: 'puzzle-container',
        width: 400,
        height: 400
    });

    const layer = new Konva.Layer();
    stage.add(layer);

    const fileInput = document.getElementById('file-input');

    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageSrc = e.target.result;
                createPuzzle(imageSrc);
            };
            reader.readAsDataURL(file);
        }
    });

    function createPuzzle(imageSrc) {
        layer.destroyChildren();

        const img = new Image();
        img.onload = function() {
            const pieces = [];
            const pieceWidth = img.width / 4;
            const pieceHeight = img.height / 4;
            
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    const piece = new Konva.Image({
                        x: col * pieceWidth,
                        y: row * pieceHeight,
                        image: img,
                        width: pieceWidth,
                        height: pieceHeight,
                        crop: {
                            x: col * pieceWidth,
                            y: row * pieceHeight,
                            width: pieceWidth,
                            height: pieceHeight
                        },
                        draggable: true
                    });
                    pieces.push(piece);
                    layer.add(piece);
                }
            }

            layer.draw();

            let emptyPiece;
            pieces.forEach(piece => {
                piece.on('dragstart', () => {
                    emptyPiece = piece;
                });
                piece.on('dragend', () => {
                    const closestPiece = pieces.reduce((prev, curr) => {
                        return (Math.abs(curr.x() - emptyPiece.x()) + Math.abs(curr.y() - emptyPiece.y()) <
                                Math.abs(prev.x() - emptyPiece.x()) + Math.abs(prev.y() - emptyPiece.y())) ? curr : prev;
                    });
                    const tempX = closestPiece.x();
                    const tempY = closestPiece.y();
                    closestPiece.position({ x: emptyPiece.x(), y: emptyPiece.y() });
                    emptyPiece.position({ x: tempX, y: tempY });
                    layer.batchDraw();
                    checkWin();
                });
            });
        };
        img.src = imageSrc;
    }

    function checkWin() {
        const pieces = layer.getChildren();
        let win = true;
        pieces.forEach((piece, index) => {
            if (piece.x() !== index % 4 * 100 || piece.y() !== Math.floor(index / 4) * 100) {
                win = false;
            }
        });
        if (win) {
            alert('Congratulations! You solved the puzzle!');
        }
    }
</script>

</body>
</html>

